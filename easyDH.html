<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Proyector Iglesia - Reina Valera Completa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body{font-family:Arial,sans-serif;margin:0;background:#f1f1f1}
  #c{max-width:900px;margin:30px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.2)}
  input,button{padding:15px;font-size:20px;margin:10px 0;width:100%;border-radius:8px;border:none}
  input{border:2px solid #ccc}
  button{background:#0066cc;color:#fff;cursor:pointer;font-weight:bold}
  .p{background:#28a745}
  #r{margin-top:20px;padding:15px;background:#f9f9f9;border-radius:8px;max-height:500px;overflow-y:auto}
  #s{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;color:#fff;font-size:7vw;display:flex;align-items:center;justify-content:center;text-align:center;padding:5%;line-height:1.9;display:none;z-index:99}
  .x{position:fixed;top:15px;right:15px;padding:15px 28px;font-size:38px;background:#c00;color:#fff;border-radius:50%;display:none;z-index:100;cursor:pointer}
  .ok{color:green;font-weight:bold;text-align:center;font-size:20px}
  .versiculo{cursor:pointer;background:#e3f2fd;padding:14px;margin:10px 0;border-radius:10px}
</style>
</head>
<body>
<div id="c">
  <h1 style="text-align:center;color:#0066cc;margin-bottom:5px">Proyector Iglesia</h1>
  <div id="status" class="ok">Cargando Biblia completa (31 102 versículos)...</div>

  <input type="text" id="q" placeholder="Juan 3:16 | Salmos 23 | amor | Salmos 23:1-6" autofocus>
  <button onclick="buscar()">Buscar versículo</button>
  <button class="p" onclick="proyectar()">Proyectar (F11)</button>
  <div id="r"></div>
</div>

<div id="s" onclick="cerrar()"><div id="t"></div></div>
<button class="x" onclick="cerrar()">X</button>

<script>
let biblia = {};

// Carga el JSON que ya está en el mismo repositorio
fetch('SPA_RV.json')
  .then(r => r.json())
  .then(data => {
    data.forEach(v => {
      const ref = `${v.book_name} ${v.chapter}:${v.verse}`;
      biblia[ref] = v.text;
      biblia[ref.toLowerCase()] = v.text;
    });
    document.getElementById("status").innerHTML = "¡BIBLIA CARGADA! 31 102 versículos listos";
  })
  .catch(() => {
    document.getElementById("status").innerHTML = "Error cargando SPA_RV.json – revisa el nombre";
  });

function buscar(){
  const q = document.getElementById("q").value.trim();
  const r = document.getElementById("r"); r.innerHTML="";
  if(!q || Object.keys(biblia).length===0) return;

  let resultados = buscarReferencia(q);
  if(resultados.length===0){
    const palabras = q.toLowerCase().split(" ").filter(p=>p.length>2);
    for(let ref in biblia){
      if(palabras.every(p=>biblia[ref].toLowerCase().includes(p))){
        resultados.push(ref);
        if(resultados.length>60) break;
      }
    }
  }

  if(resultados.length===0){
    r.innerHTML="<i>No se encontró nada</i>";
    return;
  }

  resultados.forEach(ref=>{
    const texto = biblia[ref.toLowerCase()||ref];
    r.innerHTML += `<div class="versiculo" onclick="ver('${ref}')">
                      <b>${ref}</b><br>${texto}</div>`;
  });
}

function buscarReferencia(q){
  q = q.toLowerCase().trim();
  let lista = [];

  // Rango: Salmos 23:1-6
  const rango = q.match(/(.+?)\s+(\d+):(\d+)-(\d+)/i);
  if(rango){
    const libroCap = rango[1].trim() + " " + rango[2];
    for(let v=parseInt(rango[3]); v<=parseInt(rango[4]); v++){
      const clave = `${libroCap}:${v}`;
      if(biblia[clave.toLowerCase()]) lista.push(clave);
    }
    return lista;
  }

  // Versículo exacto
  const exacto = Object.keys(biblia).find(k => k.toLowerCase() === q || k.toLowerCase().includes(q));
  if(exacto) return [exacto];

  // Capítulo completo
  const cap = q.match(/(.+?)\s+(\d+)/i);
  if(cap){
    const libro = cap[1].trim(), chapter = cap[2];
    for(let v=1; v<=200; v++){
      const clave = `${libro} ${chapter}:${v}`;
      if(biblia[clave.toLowerCase()]) lista.push(clave);
      else break;
    }
  }
  return lista;
}

function ver(ref){
  const texto = biblia[ref.toLowerCase()||ref];
  document.getElementById("t").innerHTML = `<div style="font-size:1.3em;color:#ff0">${ref}</div><br>${texto}`;
  document.getElementById("s").style.display="flex";
  document.querySelector(".x").style.display="block";
}

function proyectar(){
  document.getElementById("t").innerHTML = document.getElementById("r").innerHTML;
  document.getElementById("s").style.display="flex";
  document.querySelector(".x").style.display="block";
}

function cerrar(){
  document.getElementById("s").style.display="none";
  document.querySelector(".x").style.display="none";
}

document.getElementById("q").addEventListener("keypress",e=>{if(e.key==="Enter") buscar();});
</script>
</body>
</html>
