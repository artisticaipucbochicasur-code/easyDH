<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Proyector Iglesia - Reina Valera Completa</title>
<style>
  body{font-family:Arial,sans-serif;margin:0;background:#f1f1f1}
  #c{max-width:900px;margin:30px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.2)}
  input,button{padding:15px;font-size:20px;margin:10px 0;width:100%;border-radius:8px;border:none}
  input{border:2px solid #ccc}
  button{background:#0066cc;color:#fff;cursor:pointer;font-weight:bold}
  .p{background:#28a745}
  #r{margin-top:20px;padding:15px;background:#f9f9f9;border-radius:8px;max-height:500px;overflow-y:auto}
  #s{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;color:#fff;font-size:7vw;display:flex;align-items:center;justify-content:center;text-align:center;padding:5%;line-height:1.9;display:none;z-index:99}
  .x{position:fixed;top:15px;right:15px;padding:15px 28px;font-size:38px;background:#c00;color:#fff;border-radius:50%;display:none;z-index:100;cursor:pointer}
  .ok{color:green;font-weight:bold;text-align:center;font-size:20px}
  .versiculo{cursor:pointer;background:#e3f2fd;padding:14px;margin:10px 0;border-radius:10px}
</style>
</head>
<body>
<div id="c">
  <h1 style="text-align:center;color:#0066cc;margin-bottom:5px">Proyector Iglesia</h1>
  <div id="status" class="ok">Cargando Biblia completa...</div>

  <input type="text" id="q" placeholder="Juan 3:16 | Salmos 23 | amor | Salmos 23:1-6" autofocus>
  <button onclick="buscar()">Buscar versículo</button>
  <button class="p" onclick="proyectar()">Proyectar (F11)</button>
  <div id="r"></div>
</div>

<div id="s" onclick="cerrar()"><div id="t"></div></div>
<button class="x" onclick="cerrar()">X</button>

<script>
let biblia = {};

fetch('SPA_RV.json')  // ← el archivo está en la misma carpeta → funciona perfecto
  .then(r => { if (!r.ok) throw new Error(); return r.json(); })
  .then(data => {
    data.forEach(v => {
      const ref = `${v.book_name} ${v.chapter}:${v.verse}`;
      biblia[ref] = v.text;
      biblia[ref.toLowerCase()] = v.text;
    });
    document.getElementById("status").innerHTML = "¡BIBLIA CARGADA! 31 102 versículos listos";
  })
  .catch(() => {
    document.getElementById("status").innerHTML = "Error: SPA_RV.json no encontrado";
  });

function buscar(){
  const q = document.getElementById("q").value.trim().toLowerCase();
  const r = document.getElementById("r"); r.innerHTML="";
  if(!q) return;

  let resultados = [];

  // Referencia exacta o capítulo
  for(let ref in biblia){
    if(ref.toLowerCase().includes(q)){
      resultados.push(ref);
      if(resultados.length>100) break;
    }
  }

  // Búsqueda por palabras si no hay referencia exacta
  if(resultados.length===0){
    const palabras = q.split(" ").filter(p=>p.length>2);
    for(let ref in biblia){
      if(palabras.every(p=>biblia[ref].toLowerCase().includes(p))){
        resultados.push(ref);
        if(resultados.length>60) break;
      }
    }
  }

  if(resultados.length===0){
    r.innerHTML="<i>No encontrado</i>";
    return;
  }

  resultados.forEach(ref=>{
    r.innerHTML += `<div class="versiculo" onclick="ver('${ref}')">
                      <b>${ref}</b><br>${biblia[ref]}</div>`;
  });
}

function ver(ref){
  document.getElementById("t").innerHTML = `<div style="font-size:1.3em;color:#ff0">${ref}</div><br>${biblia[ref]}`;
  document.getElementById("s").style.display="flex";
  document.querySelector(".x").style.display="block";
}

function proyectar(){
  document.getElementById("t").innerHTML = document.getElementById("r").innerHTML;
  document.getElementById("s").style.display="flex";
  document.querySelector(".x").style.display="block";
}

function cerrar(){
  document.getElementById("s").style.display="none";
  document.querySelector(".x").style.display="none";
}

document.getElementById("q").addEventListener("keypress",e=>{if(e.key==="Enter") buscar();});
</script>
</body>
</html>
